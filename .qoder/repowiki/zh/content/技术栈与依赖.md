# 技术栈与依赖

<cite>
**本文档中引用的文件**  
- [package.json](file://package.json)
- [vite.config.ts](file://vite.config.ts)
- [tsconfig.json](file://tsconfig.json)
- [tailwind.config.js](file://tailwind.config.js)
- [capacitor.config.ts](file://capacitor.config.ts)
- [supabase.ts](file://src/lib/supabase.ts)
- [index.ts](file://src/store/index.ts)
- [index.tsx](file://src/router/index.tsx)
- [main.tsx](file://src/main.tsx)
- [App.tsx](file://src/App.tsx)
</cite>

## 目录
1. [项目概述](#项目概述)
2. [前端框架与构建工具](#前端框架与构建工具)
3. [类型安全与开发语言](#类型安全与开发语言)
4. [样式系统与UI开发](#样式系统与ui开发)
5. [核心依赖库分析](#核心依赖库分析)
6. [移动平台集成](#移动平台集成)
7. [包管理策略](#包管理策略)
8. [配置文件详解](#配置文件详解)
9. [新开发者环境搭建](#新开发者环境搭建)

## 项目概述
funnyrecord 是一个基于现代 Web 技术栈构建的心情记录应用，支持 Web 和原生移动平台（Android/iOS）的跨平台运行。项目采用模块化架构，结合 Supabase 提供后端服务，使用 React 18 构建用户界面，并通过 Capacitor 实现移动设备功能访问。整体技术选型注重开发效率、类型安全、可维护性与跨平台兼容性。

## 前端框架与构建工具
项目采用 **React 18** 作为核心前端框架，利用其函数式组件、Hooks 机制和并发渲染能力，实现高效的状态管理和组件复用。React 的声明式编程模型显著提升了 UI 开发的可预测性和可测试性。

构建工具选用 **Vite**，替代传统的 Webpack 方案。Vite 基于 ES 模块原生支持，提供极快的冷启动开发服务器和高效的热模块替换（HMR），极大提升了开发体验。通过 `vite.config.ts` 配置插件链，集成 React 支持、路径别名、PWA 功能等。

**Section sources**
- [main.tsx](file://src/main.tsx#L1-L11)
- [vite.config.ts](file://vite.config.ts#L1-L68)

## 类型安全与开发语言
项目全面采用 **TypeScript** 作为开发语言，通过静态类型系统在编译期捕获潜在错误，提升代码健壮性和可维护性。TypeScript 提供了接口（interface）、泛型、类型推断等高级特性，使复杂数据结构（如用户资料、心情记录）的定义更加清晰。

在 `tsconfig.json` 中配置了现代编译选项，包括 `ES2020` 目标、模块解析模式为 `bundler`、启用严格模式（`strict: false` 表示部分启用以平衡灵活性与安全性），并通过路径映射 `@/*` 简化模块导入。

**Section sources**
- [tsconfig.json](file://tsconfig.json#L1-L37)
- [supabase.ts](file://src/lib/supabase.ts#L1-L47)

## 样式系统与UI开发
项目使用 **Tailwind CSS** 作为原子化 CSS 框架，实现高效、一致的样式开发。Tailwind 提供大量预定义的实用类（utility classes），允许开发者直接在 JSX 中编写样式，避免传统 CSS 命名冲突和样式表膨胀问题。

`tailwind.config.js` 配置文件启用了基于类名的暗色模式切换（`darkMode: "class"`），并定义了内容扫描路径以确保生成的 CSS 包含所有使用的类。通过 `@apply` 指令或 `clsx`/`tailwind-merge` 工具库，可组合和条件化应用样式类。

**Section sources**
- [tailwind.config.js](file://tailwind.config.js#L1-L14)
- [package.json](file://package.json#L30-L31)

## 核心依赖库分析
项目依赖多个轻量级、高专注度的第三方库，各司其职，共同构建完整应用功能。

### 身份验证与数据库操作：@supabase/supabase-js
`@supabase/supabase-js` 是 Supabase 的官方 JavaScript 客户端，提供身份验证、实时数据库访问和存储功能。项目通过 `supabase.ts` 单例初始化客户端，封装了用户登录、注册、登出及数据表（`mood_records`, `user_profiles`）的 CRUD 操作。

在 `useAuthStore` 和 `useMoodStore` 中，通过该库实现用户状态同步和数据持久化，支持本地存储回退机制（体验模式/本地用户），确保离线可用性。

**Section sources**
- [supabase.ts](file://src/lib/supabase.ts#L1-L47)
- [index.ts](file://src/store/index.ts#L1-L558)

### 全局状态管理：zustand
项目采用 **zustand** 作为全局状态管理方案，替代 Redux。Zustand 以极简 API 提供基于 React Hooks 的状态管理，通过 `create` 函数定义包含状态和更新逻辑的 store。

`useAuthStore` 管理用户认证状态（登录、登出、资料加载），`useMoodStore` 管理心情记录和标签数据。Zustand 的中间件支持和 TypeScript 友好性使其成为轻量级应用的理想选择。

**Section sources**
- [index.ts](file://src/store/index.ts#L1-L558)

### 客户端路由：react-router-dom
`react-router-dom` v7 实现单页应用（SPA）的客户端路由。`router/index.tsx` 中定义了 `/auth`、`/record`、`/history` 等路由路径，通过 `createBrowserRouter` 配置嵌套路由结构，结合 `Layout` 组件实现页面布局复用。

路由系统与 React 组件深度集成，确保页面切换无刷新，提升用户体验。

**Section sources**
- [index.tsx](file://src/router/index.tsx#L1-L45)

### 数据可视化：chart.js
`chart.js` 与 `react-chartjs-2` 结合，用于 `Stats` 页面的心情数据可视化。支持折线图、柱状图等多种图表类型，直观展示情绪变化趋势。其可配置性强，易于集成到 React 组件中。

**Section sources**
- [package.json](file://package.json#L30-L31)

### 用户反馈：sonner
`sonner` 提供现代化的 Toast 通知组件，用于显示操作成功、错误等瞬时反馈。在 `App.tsx` 中全局注册 `<Toaster>`，通过 `richColors`、`closeButton` 等配置实现美观且用户友好的通知体验。

**Section sources**
- [App.tsx](file://src/App.tsx#L1-L28)

## 移动平台集成
项目使用 **Capacitor** 框架将 Web 应用打包为原生 Android 和 iOS 应用。Capacitor 提供统一的 JavaScript API 访问设备功能（如摄像头、文件系统、推送通知），并支持通过插件扩展。

`capacitor.config.ts` 定义了应用元数据（`appId`, `appName`）和 Web 资源目录（`webDir: 'dist'`）。通过 `pnpm android:dev` 或 `pnpm ios:dev` 命令可一键构建并运行原生应用，实现跨平台开发。

**Section sources**
- [capacitor.config.ts](file://capacitor.config.ts#L1-L10)
- [package.json](file://package.json#L10-L14)

## 包管理策略
项目采用 **pnpm** 作为包管理器，替代 npm 或 yarn。pnpm 通过硬链接和符号链接实现磁盘空间高效利用，避免重复安装依赖，显著减少 `node_modules` 体积和安装时间。

`pnpm-lock.yaml` 文件确保依赖版本一致性，`package.json` 中的 `scripts` 包含针对 pnpm 优化的构建流程（如 `build:mobile`）。

**Section sources**
- [package.json](file://package.json#L1-L61)
- [pnpm-lock.yaml](file://pnpm-lock.yaml)

## 配置文件详解
项目包含多个关键配置文件，分别定制不同工具的行为。

### vite.config.ts
Vite 的主配置文件，定义了：
- 构建 sourcemap 为隐藏模式
- 插件链：`@vitejs/plugin-react`（React 支持）、`vite-plugin-pwa`（PWA 功能）、`vite-plugin-trae-solo-badge`（徽章插件）、`vite-tsconfig-paths`（路径别名）
- PWA manifest 信息（应用名称、图标、主题色等）

**Section sources**
- [vite.config.ts](file://vite.config.ts#L1-L68)

### tsconfig.json
TypeScript 编译配置，关键设置包括：
- 目标为 `ES2020`
- 模块系统为 `ESNext`
- 启用 `strict` 模式（部分）
- 路径映射 `@/*` 指向 `src/*`
- 包含 `src` 目录下的所有文件

**Section sources**
- [tsconfig.json](file://tsconfig.json#L1-L37)

### tailwind.config.js
Tailwind CSS 配置，定义了：
- 暗色模式策略为 `class`
- 内容扫描路径（HTML 和 JSX 文件）
- 容器居中布局
- 无额外插件

**Section sources**
- [tailwind.config.js](file://tailwind.config.js#L1-L14)

### capacitor.config.ts
Capacitor 配置，包含：
- 应用唯一标识符 `com.mooddiary.app`
- 应用显示名称 `心情日记`
- Web 资源输出目录 `dist`

**Section sources**
- [capacitor.config.ts](file://capacitor.config.ts#L1-L10)

## 新开发者环境搭建
新开发者可通过以下步骤快速搭建开发环境：
1. 安装 Node.js（建议 v18+）和 pnpm
2. 克隆仓库并执行 `pnpm install` 安装依赖
3. 配置 Supabase 环境变量（`.env` 文件中的 `VITE_SUPABASE_URL` 和 `VITE_SUPABASE_ANON_KEY`）
4. 运行 `pnpm dev` 启动开发服务器（默认端口 5173）
5. 运行 `pnpm build` 构建生产版本
6. 使用 `pnpm android:dev` 或 `pnpm ios:dev` 构建并运行移动应用

项目结构清晰，`src` 目录下按功能划分组件、页面、状态管理等模块，便于理解和维护。

**Section sources**
- [package.json](file://package.json#L5-L14)
- [README.md](file://README.md)