# 快速入门指南

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [MOBILE_BUILD_GUIDE.md](file://MOBILE_BUILD_GUIDE.md)
- [package.json](file://package.json)
- [capacitor.config.ts](file://capacitor.config.ts)
- [vite.config.ts](file://vite.config.ts)
- [src/lib/supabase.ts](file://src/lib/supabase.ts)
- [src/main.tsx](file://src/main.tsx)
</cite>

## 目录
1. [简介](#简介)
2. [环境准备](#环境准备)
3. [项目克隆与依赖安装](#项目克隆与依赖安装)
4. [启动开发服务器](#启动开发服务器)
5. [环境变量配置](#环境变量配置)
6. [移动端构建指南](#移动端构建指南)
7. [常见问题排查](#常见问题排查)
8. [验证运行结果](#验证运行结果)

## 简介
`funnyrecord` 是一个基于 React + TypeScript + Vite 构建的心情记录应用，支持 Web 端和移动端（Android/iOS）部署。本指南面向新手开发者，提供从零开始搭建本地开发环境、运行项目并构建移动端应用的完整流程。

**Section sources**
- [README.md](file://README.md#L1-L57)

## 环境准备
在开始之前，请确保您的开发环境已安装以下工具：

- **Node.js**：版本 18 或更高
- **pnpm**：包管理工具，可通过 `npm install -g pnpm` 安装
- **Android Studio**（仅构建 Android 应用时需要）
- **Xcode**（仅构建 iOS 应用时需要，需 macOS）

验证安装是否成功：
```bash
node --version
pnpm --version
```

## 项目克隆与依赖安装
1. 克隆项目仓库：
```bash
git clone https://github.com/your-username/funnyrecord.git
cd funnyrecord
```

2. 安装项目依赖：
```bash
pnpm install
```
该命令将根据 `pnpm-lock.yaml` 文件安装所有必要的依赖项。

**Section sources**
- [package.json](file://package.json#L1-L62)

## 启动开发服务器
安装完成后，启动本地开发服务器：
```bash
pnpm dev
```
Vite 将启动开发服务器，默认监听 `http://localhost:5173`。

访问 [http://localhost:5173](http://localhost:5173) 即可查看 Web 端应用界面。

**Section sources**
- [package.json](file://package.json#L6-L10)

## 环境变量配置
项目依赖 Supabase 作为后端服务，需配置以下环境变量：

创建 `.env` 文件，内容如下：
```
VITE_SUPABASE_URL=your_supabase_project_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

> ⚠️ 注意：环境变量名必须以 `VITE_` 开头，才能在 Vite 项目中通过 `import.meta.env` 访问。

相关代码验证：
```ts
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY
```

若未配置，项目启动时将抛出错误：
```ts
if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables')
}
```

**Section sources**
- [src/lib/supabase.ts](file://src/lib/supabase.ts#L2-L5)
- [vite.config.ts](file://vite.config.ts#L1-L68)

## 移动端构建指南
本项目使用 Capacitor 实现 Web 应用向原生移动应用的转换。详细步骤请参考 `MOBILE_BUILD_GUIDE.md`。

### 添加 Android 平台
```bash
npx cap add android
```

### 构建并同步资源
```bash
pnpm build:mobile
```
该命令会先构建 Web 资源，再同步到原生项目中。

### 使用 Android Studio 打开项目
```bash
pnpm cap:open:android
```
此命令将自动打开 Android Studio，您可在其中构建 APK。

### 构建发布版本
```bash
cd android
./gradlew assembleRelease
```

**Section sources**
- [MOBILE_BUILD_GUIDE.md](file://MOBILE_BUILD_GUIDE.md#L1-L250)
- [capacitor.config.ts](file://capacitor.config.ts#L1-L10)
- [package.json](file://package.json#L11-L20)

## 常见问题排查

### 1. 依赖冲突或安装失败
解决方案：
```bash
pnpm clean
rm -rf node_modules
pnpm install
```

### 2. 端口占用（5173）
查看占用进程并终止：
```bash
lsof -i :5173
kill -9 <PID>
```
或启动时指定端口：
```bash
pnpm dev -- --port 5174
```

### 3. Capacitor 同步失败
运行诊断命令：
```bash
npx cap doctor
```
确保 Android SDK、JDK 版本正确（JDK 17+）。

### 4. 构建失败
清理 Android 缓存：
```bash
cd android
./gradlew clean
```

**Section sources**
- [MOBILE_BUILD_GUIDE.md](file://MOBILE_BUILD_GUIDE.md#L200-L249)

## 验证运行结果
成功运行后，您应看到以下界面：

- **Web 端**：在浏览器中显示“心情日记”主界面，包含情绪记录、历史、统计等功能模块。
- **PWA 支持**：支持添加到主屏幕，具备离线访问能力。
- **移动端**：通过 Android Studio 构建的 APK 可在设备上安装运行，具备原生应用体验。

预期界面特征：
- 应用名称为“心情日记”
- 主题色为蓝色 (#3b82f6)
- 支持横竖屏切换
- 图标包括 `pwa-192x192.png`、`apple-touch-icon.png` 等

**Section sources**
- [vite.config.ts](file://vite.config.ts#L30-L67)
- [capacitor.config.ts](file://capacitor.config.ts#L4-L6)